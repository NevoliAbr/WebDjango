{% extends 'base.html' %}

{% block title %}
  {% if user.is_authenticated %}
    Dashboard de Motos
  {% else %}
    Consulta el estado de tu moto
  {% endif %}
{% endblock %}

{% block content %}

{% if user.is_authenticated %}
  {# --- VISTA PARA EL USUARIO AUTENTICADO (ADMIN) --- #}

  <div class="dashboard-header">
    <h1 class="dashboard-title">Motos en Taller</h1>
    <a href="{% url 'agregar' %}" class="add-moto-btn">
      <span class="material-symbols-outlined">add_circle</span>
      Agregar Nueva Moto
    </a>
  </div>

  <div class="moto-grid">
    {% for moto in lista_motos %}
      <div class="moto-card">
        {% if moto.imagen %}
          <img src="{{ moto.imagen.url }}" alt="Imagen de {{ moto.modelo }}" class="moto-image">
        {% endif %}
        <div class="moto-card-content">
          <h3 class="moto-model">{{ moto.modelo }} (ID: {{ moto.id }})</h3>
          <p class="moto-owner"><strong>Propietario:</strong> {{ moto.propietario }}</p>
          <p class="moto-assigned"><strong>Asignado a:</strong> {{ moto.asignado }}</p>
          <p class="moto-date"><strong>Fecha de inicio:</strong> {{ moto.fecha_inicio_trabajo|date:"d/m/Y" }}</p>
          
          <div class="moto-pricing">
            <p><strong>Mano de obra:</strong> ${{ moto.precio_mano_obra }}</p>
            <p><strong>Accesorios:</strong> ${{ moto.precio_accesorios }}</p>
            <p><strong>Pago inicial:</strong> ${{ moto.pago_inicial }}</p>
          </div>

          <a href="{% url 'terminar_trabajo' moto_id=moto.id %}" class="finish-work-btn">Terminar Trabajo</a>
        </div>
      </div>
    {% empty %}
      <div class="no-motos-message">
        <p>¡Felicidades! No hay trabajos pendientes.</p>
        <p>Puedes agregar una nueva moto para empezar a trabajar.</p>
      </div>
    {% endfor %}
  </div>

{% else %}
  {# --- VISTA PARA EL USUARIO PÚBLICO (CLIENTE) --- #}

  <div class="public-search-container">
    <h1 class="public-search-title">Consulta el estado de tu moto</h1>
    <p class="public-search-subtitle">Introduce el ID de tu trabajo para ver los detalles y el estado actual.</p>

    <form method="GET" action="{% url 'inicio' %}" class="search-form">
      <input type="text" name="moto_id" class="search-input" placeholder="Escribe el ID de tu moto..." value="{{ request.GET.moto_id }}">
      <button type="submit" class="search-button">Buscar</button>
    </form>

    {% if moto_encontrada %}
      <div class="moto-grid" style="margin-top: 2rem;">
        <div class="moto-card">
          {% if moto_encontrada.imagen %}
            <img src="{{ moto_encontrada.imagen.url }}" alt="Imagen de {{ moto_encontrada.modelo }}" class="moto-image">
          {% endif %}
          <div class="moto-card-content">
            <h3 class="moto-model">{{ moto_encontrada.modelo }}</h3>
            <p class="moto-owner"><strong>Propietario:</strong> {{ moto_encontrada.propietario }}</p>
            <p class="moto-date"><strong>Fecha de inicio:</strong> {{ moto_encontrada.fecha_inicio_trabajo|date:"d/m/Y" }}</p>
            
            {% if moto_encontrada.activo %}
              <div class="status-badge in-progress">
                <span class="material-symbols-outlined">construction</span>
                <span>Trabajo en Progreso</span>
              </div>
            {% else %}
              <div class="status-badge finished">
                <span class="material-symbols-outlined">check_circle</span>
                <span>Trabajo Finalizado</span>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    {% endif %}
  </div>

<style>
  .public-search-container {
    max-width: 600px;
    margin: 2rem auto;
    padding: 2rem;
    text-align: center;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }
  .public-search-title { font-size: 2rem; color: #333; }
  .public-search-subtitle { color: #666; margin-bottom: 2rem; }
  .search-form { display: flex; }
  .search-input {
    flex-grow: 1;
    padding: 12px 15px;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 4px 0 0 4px;
  }
  .search-button {
    padding: 12px 20px;
    font-size: 1rem;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 0 4px 4px 0;
    cursor: pointer;
  }
  .status-badge {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 10px;
    margin-top: 1rem;
    border-radius: 5px;
    font-weight: 500;
    color: white;
  }
  .status-badge.in-progress { background-color: #ffc107; color: #333; }
  .status-badge.finished { background-color: #28a745; }
</style>

{% endif %}

{% endblock %}
